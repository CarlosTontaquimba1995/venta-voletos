<div class="stepper-container">
    <mat-horizontal-stepper #stepper [linear]="isLinear" class="custom-stepper">
        <!-- Step 1: Event Selection -->
        <mat-step [stepControl]="firstFormGroup" [completed]="stepper.selectedIndex > 0">
            <ng-template matStepLabel>
                <div class="step-label">
                    <div class="step-number" [class.active]="stepper.selectedIndex === 0">1</div>
                    <span class="step-description">Evento</span>
                </div>
            </ng-template>
            <div class="step-content">
                <app-event-selection-step [events]="events" [selectedEvent]="selectedEvent"
                    (eventSelected)="onEventSelected($event)">
                </app-event-selection-step>
            </div>
            <div class="stepper-actions">
                <button mat-stroked-button color="primary" *ngIf="stepper.selectedIndex > 0" (click)="stepper.previous()">
                    Anterior
                </button>
                <button mat-raised-button color="primary" [disabled]="!firstFormGroup.valid || !selectedEvent" (click)="goToNextStep()">
                    Siguiente
                </button>
            </div>
        </mat-step>

        <!-- Step 2: Seat Selection -->
        <mat-step [stepControl]="secondFormGroup" [completed]="stepper.selectedIndex > 1">
            <ng-template matStepLabel>
                <div class="step-label">
                    <div class="step-number" [class.active]="stepper.selectedIndex === 1">2</div>
                    <span class="step-description">Asientos</span>
                </div>
            </ng-template>
            <div class="step-content">
                <form [formGroup]="secondFormGroup">
                    <app-seat-selection-step [seatTypes]="seatTypes" [selectedSeatType]="selectedSeatType" [quantity]="quantity"
                        (seatSelected)="onSeatSelected($event)" (quantityChanged)="onQuantityChange($event)"
                        (seatSelectionsChange)="onSeatSelectionsChange($event)">
                    </app-seat-selection-step>
                </form>
                </div>
            <div class="stepper-actions">
                <button mat-stroked-button matStepperPrevious>Atrás</button>
                <button mat-raised-button color="primary" [disabled]="!secondFormGroup.valid || selectedSeats.length === 0"
                    matStepperNext>
                    Siguiente
                </button>
            </div>
        </mat-step>

        <!-- Step 3: Personal Information -->
        <mat-step [stepControl]="thirdFormGroup" [completed]="stepper.selectedIndex > 2">
            <ng-template matStepLabel>
                <div class="step-label">
                    <div class="step-number" [class.active]="stepper.selectedIndex === 2">3</div>
                    <span class="step-description">Datos</span>
                </div>
            </ng-template>
            <div class="step-content">
                <app-personal-info-step [formGroup]="thirdFormGroup" (formSubmitted)="onPersonalInfoSubmit()">
                </app-personal-info-step>
            </div>
            <div class="stepper-actions">
                <button mat-stroked-button (click)="stepper.previous()">
                    Anterior
                </button>
                <button mat-raised-button color="primary" [disabled]="!thirdFormGroup.valid" (click)="onPersonalInfoSubmit()">
                    Siguiente
                </button>
            </div>
        </mat-step>

        <!-- Step 4: Confirmation -->
        <mat-step [completed]="isCompleted">
            <ng-template matStepLabel>
                <div class="step-label">
                    <div class="step-number" [class.active]="stepper.selectedIndex === 3">4</div>
                    <span class="step-description">Confirmación</span>
                </div>
            </ng-template>
            <div class="step-content">
                <app-confirmation-step [event]="selectedEvent" [selectedSeats]="selectedSeats" [personalInfo]="personalInfo">
                </app-confirmation-step>
            </div>
            <div class="stepper-actions">
                <button mat-stroked-button matStepperPrevious>Atrás</button>
                <button mat-raised-button color="primary" (click)="onConfirmPurchase()" [disabled]="!isCompleted">
                    Confirmar compra
                </button>
            </div>
        </mat-step>
    </mat-horizontal-stepper>
</div>